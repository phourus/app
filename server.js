var express = require('express');
var React = require('react');
var jsx = require('node-jsx').install();

var fs = require('fs');

var phourus = express();

phourus.get('', function(req, res){
    var template = fs.readFile('build/index.html', 'utf8', function(err, out){
        //var component = renderComponent('landing');
        //out = out.replace('$CONTENT', component);
        res.send(out, 200);
    });   
});

var respond = function(req, res){
    var id, out;
    id = req.route.path;
    parts = id.split('/');
    out = compile(parts[1]);
    res.send(out, 200);
}

phourus.get('/search', respond);
phourus.get('/post/:id', respond);
phourus.get('/editor', respond);
phourus.get('/profile/:id', respond);
phourus.get('/account', respond);
phourus.get('/game', respond);
phourus.get('/general', respond);


phourus.get('/rest/posts', function (req, res) {
    res.json([{"post":{"id":40,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":4,"privacy":"phourus","influence":63,"type":"blogs"},"meta":{"post_id":40,"title":"Atheist vs. Agnostic?","element":"faith","category":"discussion","content":"No eam graecis mediocritatem, pro ut putent accusata, tempor integre lobortis ne vel. At mei civibus blandit, adhuc consequuntur te eam, eu sed mazim perfecto efficiantur. Quando laboramus intellegebat ea sea, vel ea saepe impetus senserit? Dolor accusamus nec te, pri in sanctus vulputate comprehensam, ne clita ridens feugait mea!","date":"0000-00-00 00:00:00","positive":0},"user":{"user":{"id":4,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"reginawall","first":"Regina","last":"Wall","email":"rwall@phourus.com","phone":"738-420-9123","status":"active","gender":"f","occupation":"Customer Support Specialist","company":"XYZ Company","website":"www.xyzco.com","dob":null,"influence":37,"img":"jpg"},"stats":{"views":3,"thumbs":2,"positive":"1","comments":0,"popularity":50,"posts":{"answers":1,"blogs":3,"events":2,"questions":1,"timeline":1},"followers":{"average":41,"total":1}},"address":[{"id":20,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":4,"street":"102 Ash Rd","city":"Louisa","state":"VA","country":"US","zip":"23093","type":"mailing","county":null}]},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":[{"id":20,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":4,"street":"102 Ash Rd","city":"Louisa","state":"VA","country":"US","zip":"23093","type":"mailing","county":null}]},{"post":{"id":28,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":3,"privacy":"public","influence":63,"type":"questions"},"meta":{"post_id":28,"title":"Need help with 2 + 2","category":"math","subcategory":"arithmetic","difficulty":"easy","content":"Praesent pretium ultricies sem, non porttitor velit lacinia non. Vestibulum porttitor molestie dolor in cursus. Duis tempus odio nec enim commodo adipiscing. Sed auctor est et venenatis hendrerit. Interdum et malesuada fames ac ante ipsum primis in faucibus. Ut euismod sollicitudin urna non viverra.\n\nMorbi nec lectus tincidunt, tristique neque at, cursus urna. Phasellus consequat, lacus nec varius tempor, massa turpis imperdiet massa, id semper felis nibh in risus. Sed viverra pellentesque felis vitae dictum. Quisque vitae nulla risus. Suspendisse at sapien nec felis lacinia dictum posuere sed arcu. Suspendisse aliquet vehicula felis. Nullam est tortor, fermentum in magna sit amet, porttitor faucibus justo. Sed ut tincidunt metus, vitae lobortis eros. Phasellus rhoncus magna vel justo egestas venenatis. Cras lobortis gravida justo et laoreet. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla consectetur enim eu ante sodales semper. Quisque ante eros, rhoncus ut blandit nec, varius et felis. Suspendisse egestas molestie felis eget varius. Vestibulum eu ornare magna. Donec semper odio laoreet semper fringilla.\n\nNunc euismod vel sem at aliquet. Morbi ut porta lacus. Sed egestas interdum eleifend. Aliquam a nulla elit. Aenean non egestas nisi, ut volutpat felis. Quisque purus sapien, ullamcorper nec suscipit at, adipiscing eget dolor. Fusce pellentesque velit in nunc rhoncus placerat."},"user":{"user":{"id":3,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"bruceisaac","first":"Bruce","last":"Isaac","email":"bruceisaac@phourus.com","phone":"940-457-1253","status":"active","gender":"m","occupation":"CTO","company":"ABC Company","website":"www.abcco.com","dob":null,"influence":60,"img":"jpg"},"stats":{"views":2,"thumbs":1,"positive":"1","comments":0,"popularity":0,"posts":{"answers":1,"bills":1,"blogs":2,"questions":2,"quotes":1,"subjects":2},"followers":{"average":52,"total":1}},"address":[{"id":19,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":3,"street":"267 Reed St","city":"Lakewood","state":"CO","country":"US","zip":"80226","type":"mailing","county":null}]},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":[{"id":19,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":3,"street":"267 Reed St","city":"Lakewood","state":"CO","country":"US","zip":"80226","type":"mailing","county":null}]},{"post":{"id":61,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":2,"privacy":"public","influence":53,"type":"bills"},"meta":{"post_id":61,"debate_id":1,"rep_id":1,"content":"Curabitur justo orci, rhoncus nec mauris ac, vulputate hendrerit orci. Nam interdum porttitor pulvinar. Aenean nisi tellus, euismod vel tempor ut, suscipit sit amet erat. In egestas luctus neque. Aliquam commodo dui nec tortor suscipit, nec dapibus lorem volutpat. Vestibulum convallis vestibulum enim, hendrerit fermentum ante lobortis ac. Vivamus nec elit ipsum. Cras non sollicitudin leo, non vehicula velit. Duis a bibendum eros, vitae vulputate sapien. ","question":"Should we expand local police department for $160k?","deadline":"2013-05-12 04:00:00"},"user":{"user":{"id":2,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"kbasil","first":"Kelly","last":"Basil","email":"kbasil@phourus.com","phone":"948-482-4841","status":"active","gender":"f","occupation":"Director of Marketing","company":"ACME Corporation","website":"www.acmecorp.com","dob":"1954-06-22","influence":52,"img":"png"},"stats":{"views":2,"thumbs":2,"positive":"1","comments":2,"popularity":50,"posts":{"answers":2,"beliefs":1,"bills":1,"blogs":2,"events":1,"questions":3,"quotes":1,"subjects":1},"followers":{"average":0,"total":0}},"address":[{"id":18,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":2,"street":"480 Sherman Rd","city":"Springfield","state":"PA","country":"US","zip":"19064","type":"mailing","county":null}]},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":[{"id":18,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":2,"street":"480 Sherman Rd","city":"Springfield","state":"PA","country":"US","zip":"19064","type":"mailing","county":null}]},{"post":{"id":65,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":6,"privacy":"phourus","influence":53,"type":"debates"},"meta":{"post_id":65,"title":"Alternative to stricter gun laws","scope":"national","category":"law","content":"Duo soluta repudiandae ea, sea legimus phaedrum eu, mea nibh bonorum sapientem ne! Et tota velit facilis quo, tale habeo mollis ad cum. Id per insolens assentior, ipsum admodum delicata mel no.\n\nEt sea posse virtute ponderum, noster alienum delicata mea an, vidit similique cu mel! Usu id nostro facilisis. Omnes oportere ei mea, graece officiis definiebas eam ea, an fierent nominati his. Ius altera alienum senserit in. Ei doming menandri tincidunt sit, idque oratio hendrerit id nam?","zip":"94041"},"user":{"user":{"id":6,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"duncanv","first":"Duncan","last":"Valentine","email":"info@duncanvalentine.com","phone":"140-431-5423","status":"active","gender":"m","occupation":"Sales Engineer","company":"ABC Company","website":"www.duncanvalentine.com","dob":null,"influence":39,"img":"jpg"},"stats":{"views":0,"thumbs":0,"positive":null,"comments":0,"popularity":0,"posts":{"blogs":2,"debates":2,"events":1,"questions":1,"subjects":1},"followers":{"average":41,"total":1}},"address":404},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":404},{"post":{"id":58,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":5,"privacy":"public","influence":52,"type":"beliefs"},"meta":{"post_id":58,"title":"Why I don\'t believe in God","category":"atheism","content":"Option accusamus ei per! Ut vis veri iudico erroribus. Quo cu quot purto simul?\n\nSimilique sadipscing pro in, mei no primis lobortis, oratio consul incorrupte ad nec. Hinc facer aeterno eu duo. Ei mea justo choro nostrud, vitae quaeque corrumpit sea ad? Ei ius natum nobis iudicabit, mei alienum phaedrum expetenda te, mel tota veri debet cu. Te vix quodsi quaestio, sit placerat deseruisse te, nam error zril fastidii at? Te quot officiis pri, mea ea vivendo oporteat"},"user":{"user":{"id":5,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"kendallk","first":"Kendall","last":"Kennedy","email":"kendallk@phourus.com","phone":"438-491-4159","status":"active","gender":"m","occupation":"Selectman","company":"Town of Trentstown","website":"www.kendallkennedy.com","dob":"1986-03-09","influence":44,"img":"jpg"},"stats":{"views":0,"thumbs":1,"positive":"0","comments":0,"popularity":0,"posts":{"answers":2,"beliefs":2,"bills":1,"blogs":1,"debates":2,"questions":1,"quotes":1,"subjects":4,"timeline":2},"followers":{"average":41,"total":1}},"address":404},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":404},{"post":{"id":4,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":4,"privacy":"public","influence":49,"type":"blogs"},"meta":{"post_id":4,"title":"Teachers & Statistics","element":"mind","category":"facts","content":"Et vim utamur postulant, vim tamquam probatus ex? Est sint atomorum an? Te sea malis mediocritatem, et ius consul officiis postulant. Modo oratio aliquando et eam.\n\nIudico tollit iriure his te. No eam graecis mediocritatem, pro ut putent accusata, tempor integre lobortis ne vel. At mei civibus blandit, adhuc consequuntur te eam, eu sed mazim perfecto efficiantur. Quando laboramus intellegebat ea sea, vel ea saepe impetus senserit? Dolor accusamus nec te, pri in sanctus vulputate comprehensam, ne clita ridens feugait mea!","date":"0000-00-00 00:00:00","positive":0},"user":{"user":{"id":4,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"reginawall","first":"Regina","last":"Wall","email":"rwall@phourus.com","phone":"738-420-9123","status":"active","gender":"f","occupation":"Customer Support Specialist","company":"XYZ Company","website":"www.xyzco.com","dob":null,"influence":37,"img":"jpg"},"stats":{"views":3,"thumbs":2,"positive":"1","comments":0,"popularity":50,"posts":{"answers":1,"blogs":3,"events":2,"questions":1,"timeline":1},"followers":{"average":41,"total":1}},"address":[{"id":20,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":4,"street":"102 Ash Rd","city":"Louisa","state":"VA","country":"US","zip":"23093","type":"mailing","county":null}]},"stats":{"comments":0,"thumbs":2,"positive":"1","popularity":50,"views":3},"address":[{"id":20,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":4,"street":"102 Ash Rd","city":"Louisa","state":"VA","country":"US","zip":"23093","type":"mailing","county":null}]},{"post":{"id":18,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":5,"privacy":"public","influence":49,"type":"timeline"},"meta":{"post_id":18,"title":"First day of Church","category":"change","date":"080430","time":"01:00p","content":"Vel solum reprehendunt in, nam eu decore facilis indoctum. Omnes albucius per et? Eum ut ocurreret voluptaria! Purto maluisset ea vis, ex simul ancillae eum, graece iisque percipit ad nec!\n\nDuo cetero imperdiet in, admodum phaedrum dissentiunt pri ex. Ne vis soluta consulatu concludaturque. Id integre omittam offendit cum, no nisl tincidunt eos, oblique aliquam eligendi te eos. Agam probo atqui per eu, aeque ornatus constituto mea ad.","address_id":5},"user":{"user":{"id":5,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"kendallk","first":"Kendall","last":"Kennedy","email":"kendallk@phourus.com","phone":"438-491-4159","status":"active","gender":"m","occupation":"Selectman","company":"Town of Trentstown","website":"www.kendallkennedy.com","dob":"1986-03-09","influence":44,"img":"jpg"},"stats":{"views":0,"thumbs":1,"positive":"0","comments":0,"popularity":0,"posts":{"answers":2,"beliefs":2,"bills":1,"blogs":1,"debates":2,"questions":1,"quotes":1,"subjects":4,"timeline":2},"followers":{"average":41,"total":1}},"address":404},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":404},{"post":{"id":57,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":5,"privacy":"public","influence":48,"type":"subjects"},"meta":{"post_id":57,"title":"Common Grammar Mistakes","category":"english","subcategory":"grammar","difficulty":"intermediate","content":"Reque falli ne eam, similique efficiendi quo no. Sea id solet phaedrum, sit no partem facilis, impetus eligendi efficiantur et eum! Mea eius persequeris ea, an sed ullum eirmod, vis id etiam lucilius. Mel omnis ubique ad, ad vis labore quidam intellegat? Eu his ferri populo ridens, alienum commune usu et, no primis labores vix. Pro ex modus ubique vidisse?\n\nEt vim utamur postulant, vim tamquam probatus ex? Est sint atomorum an? Te sea malis mediocritatem, et ius consul officiis postulant. Modo oratio aliquando et eam.\n\nIudico tollit iriure his te. No eam graecis mediocritatem, pro ut putent accusata, tempor integre lobortis ne vel. At mei civibus blandit, adhuc consequuntur te eam, eu sed mazim perfecto efficiantur. Quando laboramus intellegebat ea sea, vel ea saepe impetus senserit? Dolor accusamus nec te, pri in sanctus vulputate comprehensam, ne clita ridens feugait mea!\n\nId sint epicurei concludaturque sit, an qui errem deserunt dissentiunt. Ut usu primis assentior. Est viris clita ex, ut odio menandri mea, te eum dicit facilisis theophrastus. An quo mundi appareat, vivendo civibus eligendi vis an. Ea vix oratio mollis, ad per lucilius maluisset mediocritatem? Errem molestie liberavisse ne sed, cu his habemus molestie."},"user":{"user":{"id":5,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"kendallk","first":"Kendall","last":"Kennedy","email":"kendallk@phourus.com","phone":"438-491-4159","status":"active","gender":"m","occupation":"Selectman","company":"Town of Trentstown","website":"www.kendallkennedy.com","dob":"1986-03-09","influence":44,"img":"jpg"},"stats":{"views":0,"thumbs":1,"positive":"0","comments":0,"popularity":0,"posts":{"answers":2,"beliefs":2,"bills":1,"blogs":1,"debates":2,"questions":1,"quotes":1,"subjects":4,"timeline":2},"followers":{"average":41,"total":1}},"address":404},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":404},{"post":{"id":59,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":3,"privacy":"public","influence":47,"type":"quotes"},"meta":{"post_id":59,"quote":"People often say that motivation doesn\u2019t last. Well, neither does bathing \u2013 that\u2019s why we recommend it daily.","author":"Zig Ziglar"},"user":{"user":{"id":3,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"bruceisaac","first":"Bruce","last":"Isaac","email":"bruceisaac@phourus.com","phone":"940-457-1253","status":"active","gender":"m","occupation":"CTO","company":"ABC Company","website":"www.abcco.com","dob":null,"influence":60,"img":"jpg"},"stats":{"views":2,"thumbs":1,"positive":"1","comments":0,"popularity":0,"posts":{"answers":1,"bills":1,"blogs":2,"questions":2,"quotes":1,"subjects":2},"followers":{"average":52,"total":1}},"address":[{"id":19,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":3,"street":"267 Reed St","city":"Lakewood","state":"CO","country":"US","zip":"80226","type":"mailing","county":null}]},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":[{"id":19,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","org_id":0,"user_id":3,"street":"267 Reed St","city":"Lakewood","state":"CO","country":"US","zip":"80226","type":"mailing","county":null}]},{"post":{"id":13,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","user_id":6,"privacy":"public","influence":45,"type":"events"},"meta":{"post_id":13,"title":"Home food growers association","element":"earth","date":"130423","time":"12:30p","content":"Mucius dolorum voluptaria nam an, quo quod atomorum cu, choro platonem id pri. Pri id brute mediocrem, ut electram intellegam nec. Ei vitae consul explicari vis. Te enim senserit ullamcorper vis, deleniti liberavisse complectitur eu vel. Aperiri eloquentiam nec ad, his te civibus pericula maluisset, te illum doctus vis? Ad eam natum liber concludaturque, epicurei nominati mel et, no pro unum eligendi theophrastus!\n\nNatum solet postea nec eu, ut detracto pericula laboramus duo! Semper concludaturque ex has. Ad nulla soleat detraxit cum! Adhuc paulo insolens sit te, ut regione voluptaria scripserit vel. Te veri aliquip similique quo. In vis quis novum, id vel melius similique eloquentiam?","address_id":1},"user":{"user":{"id":6,"created":"0000-00-00 00:00:00","modified":"0000-00-00 00:00:00","username":"duncanv","first":"Duncan","last":"Valentine","email":"info@duncanvalentine.com","phone":"140-431-5423","status":"active","gender":"m","occupation":"Sales Engineer","company":"ABC Company","website":"www.duncanvalentine.com","dob":null,"influence":39,"img":"jpg"},"stats":{"views":0,"thumbs":0,"positive":null,"comments":0,"popularity":0,"posts":{"blogs":2,"debates":2,"events":1,"questions":1,"subjects":1},"followers":{"average":41,"total":1}},"address":404},"stats":{"comments":0,"thumbs":0,"positive":null,"popularity":0,"views":0},"address":404}]);
});

var compile = function(id){
    var out;
    var file = fs.readFileSync('build/template.html', 'utf8');
    var component = renderComponent(id);
    file = file.replace('$CONTENT', component);
    file = file.replace('$SCRIPT', '<script type="text/javascript" src="/react/' + id + '.js"></script>');
    return file;   
}

phourus.get('/data', function(req, res){
    var out = {};
    out.title = "Test AJAX";
    out.content = "Worked";
    res.send(out, 200);
});

//phourus.all('', function(req, res) { res.redirect(__dirname); });
phourus.use(express.static(__dirname + '/build'));

function renderComponent(id){
    var component = require('./src/react/' + id);
    return React.renderToString(component());    
}


phourus.listen(4567, function(){
    console.log('server started');
});